# Pipeline Name
name: DevSecOps-Tools

# pipeline trigger
on: [push]

# SAST job 
jobs:
    SAST-SCAN:
        # Machine to run the job
        name: Run SAST Scan
        runs-on: ubuntu-latest

        steps:
        # Clone repository to server
        - name: Checkout Code
          uses: actions/checkout@v4

        - name: Setup Python
          uses: actions/setup-python@v5.0.0
          with:
          # Version range or exact version of Python
            python-version: 3.8

        - name: Install Bandit Scanner
          run: pip install bandit

        #   Scan all file in the repository recursively
        - name: Run Bandit Scan
          run: bandit -lll -r . -o report-card.json -f json

        #  Generate report file for Vulnurability management tools
        - name: Upload Output as an artifact
          uses: actions/upload-artifact@v3
          if: always()
          with:
            name: bandit-result
            path: report-card.json


  DOCKER-IMAGE-SCAN:
      # Machine to run the job
      name: Run Image Scan
      runs-on: ubuntu-latest

      steps:
        # Clone repository to server
        - name: Checkout Code
          uses: actions/checkout@v4

        - name: Docker Setup Buildx
          # You may pin to the exact commit or the version.
          # uses: docker/setup-buildx-action@f95db51fddba0c2d1ec667646a06c2ce06100226
          uses: docker/setup-buildx-action@v3.0.0
          with:
            # Buildx version. (eg. v0.3.0)
            version: "20.10.07"
            # Sets the builder driver to be used

        - name: Docker Build
          run: docker build -f Dockerfile -t devsecops-app:latest .